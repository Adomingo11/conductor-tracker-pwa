<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conductor Tracker - Standalone</title>
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Conductor Tracker">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM0ZmQxYzciLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMWExZjJlIj4KPHA+PHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIi8+CjwvcD4KPC9zdmc+Cjwvc3ZnPg==">
    
    <!-- Android Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4fd1c7">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM0ZmQxYzciLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMWExZjJlIj4KPHA+PHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIi8+CjwvcD4KPC9zdmc+Cjwvc3ZnPg==">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNvbmR1Y3RvciBUcmFja2VyIiwKICAic2hvcnRfbmFtZSI6ICJDb25kdWN0b3IiLAogICJkZXNjcmlwdGlvbiI6ICJBcGxpY2FjacOzbiBkZSBzZWd1aW1pZW50byBkZSBhY3RpdmlkYWQgcGFyYSBjb25kdWN0b3JlcyIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzFhMWYyZSIsCiAgInRoZW1lX2NvbG9yIjogIiM0ZmQxYzciLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVGt5SWlCb1pXbG5hSFE5SWpFNU1pSWdkbWxsZDBKdmVEMGlNQ0F3SURFNU1pQXhPVElpSUdacGJHdzlJbTV2Ym1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0NqeHlaV04wSUhkcFpIUm9QU0l4T1RJaUlHaGxhV2RvZEQwaU1Ua3lJaUJ5ZUQwaU1qUWlJR1pwYkd3OUlpTTBabVF4WXpjaUx6NEtQSE4yWnlCNFBTSTBPQ0lnZVQwaU5EZ2lJSGRwWkhSb1BTSTVOaUlnYUdWcFoyaDBQU0k1TmlJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElpQm1hV3hzUFNJak1XRXhaamxsUFNJK0NrTndQanh3WVhSb0lHUTlTVzB4TWlBeVRERXpMakE1SURndU1qWk1NakFnT1V3eE15NHdPU0F4TlM0M05FeE1URElnTWpKTU1UQXVPVEVnTVRVdU56Uk1OQ0E1VERFd0xqa3hJRGd1TWpaTU1USWdNbHBhSWk4K0NrTXZjRDRLUEM5emRtYytDand2YzNabkBnPT0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- Service Worker for offline functionality -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbChjYWNoZXMub3BlbignY29uZHVjdG9yLXRyYWNrZXItdjEnKS50aGVuKGNhY2hlID0+IHsKICAgIHJldHVybiBjYWNoZS5hZGRBbGwoWycuLyddKTsKICB9KSk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpOwogICAgfSkKICApOwp9KTs=');
        }
    </script>
    <style>
        :root {
            --bg-primary: #1a1f2e;
            --bg-secondary: #252b3d;
            --bg-card: #2d3548;
            --text-primary: #ffffff;
            --text-secondary: #a0a9c0;
            --accent-primary: #4fd1c7;
            --accent-secondary: #3b82f6;
            --border-color: #3d4458;
            --success-color: #10b981;
            --error-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .navigation {
            background-color: var(--bg-secondary);
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .main-content {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            border: none;
            color: var(--text-primary);
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin: 1rem 0;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border: none;
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .form-section {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
        }

        .metric-circle {
            width: 80px;
            height: 80px;
            border: 3px solid var(--accent-primary);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .metric-unit {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .calculation-preview {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .calc-line {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .calc-total {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0 0;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--accent-primary);
            border-top: 2px solid var(--accent-primary);
            margin-top: 1rem;
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 500;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--error-color);
        }

        .notification.info {
            background-color: var(--accent-secondary);
        }

        .notification.hidden {
            opacity: 0;
            transform: translateX(100%);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .button-group button {
            flex: 1;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .navigation {
                padding: 0.5rem;
            }
            .nav-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <nav class="navigation">
            <button class="nav-btn active" data-view="dashboard">Dashboard</button>
            <button class="nav-btn" data-view="registro">Registro</button>
            <button class="nav-btn" data-view="historial">Historial</button>
            <button class="nav-btn" data-view="ajustes">Ajustes</button>
        </nav>

        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <h1>Panel de Control</h1>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-circle">
                            <span class="metric-value" id="total-km">0</span>
                            <span class="metric-unit">km</span>
                        </div>
                        <h3>Km Totales</h3>
                    </div>
                    <div class="metric-card">
                        <div class="metric-circle">
                            <span class="metric-value" id="total-carreras">0</span>
                            <span class="metric-unit">carreras</span>
                        </div>
                        <h3>Carreras Totales</h3>
                    </div>
                    <div class="metric-card">
                        <div class="metric-circle">
                            <span class="metric-value" id="total-ganancias">0</span>
                            <span class="metric-unit">‚Ç¨</span>
                        </div>
                        <h3>Ganancia Neta</h3>
                    </div>
                </div>
                <button class="btn-primary" onclick="navigateTo('registro')">Registrar Nuevo D√≠a</button>
            </div>

            <!-- Registro View -->
            <div id="registro-view" class="view">
                <h2>Registro Diario</h2>
                <form id="registro-form">
                    <div class="form-section">
                        <div class="form-group">
                            <label for="fecha-registro">Fecha del Registro</label>
                            <input type="date" id="fecha-registro" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="km-recorridos">Km Recorridos</label>
                                <input type="number" id="km-recorridos" min="0" step="0.1" value="0">
                            </div>
                            <div class="form-group">
                                <label for="num-carreras">N¬∫ de Carreras</label>
                                <input type="number" id="num-carreras" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Uber</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="uber-app">Uber App (‚Ç¨)</label>
                                <input type="number" id="uber-app" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="uber-propinas">Propinas Uber (‚Ç¨)</label>
                                <input type="number" id="uber-propinas" min="0" step="0.01" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>FreeNow</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="freenow-app">App (‚Ç¨)</label>
                                <input type="number" id="freenow-app" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="freenow-tarjeta">Tarjeta (‚Ç¨)</label>
                                <input type="number" id="freenow-tarjeta" min="0" step="0.01" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="freenow-efectivo">Efectivo (‚Ç¨)</label>
                                <input type="number" id="freenow-efectivo" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="freenow-propinas">Propinas (‚Ç¨)</label>
                                <input type="number" id="freenow-propinas" min="0" step="0.01" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Taxi Convencional</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="taxi-tarjeta">Tarjeta (‚Ç¨)</label>
                                <input type="number" id="taxi-tarjeta" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="taxi-efectivo">Efectivo (‚Ç¨)</label>
                                <input type="number" id="taxi-efectivo" min="0" step="0.01" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Gastos</h3>
                        <div class="form-group">
                            <label for="combustible">Combustible (‚Ç¨)</label>
                            <input type="number" id="combustible" min="0" step="0.01" value="0">
                        </div>
                    </div>

                    <div class="calculation-preview">
                        <h4>Vista Previa del C√°lculo</h4>
                        <div class="calc-line">Ganancia Bruta: <span id="ganancia-bruta">0.00</span>‚Ç¨</div>
                        <div class="calc-line">- Comisi√≥n Veh√≠culo (52%): <span id="comision-vehiculo">0.00</span>‚Ç¨</div>
                        <div class="calc-line">- Costo Kilometraje: <span id="costo-km">0.00</span>‚Ç¨</div>
                        <div class="calc-line">- Comisi√≥n FreeNow Efectivo (6%): <span id="comision-freenow">0.00</span>‚Ç¨</div>
                        <div class="calc-line">+ Gastos Combustible: <span id="gastos-combustible">0.00</span>‚Ç¨</div>
                        <div class="calc-total">Ganancia Neta: <span id="ganancia-neta">0.00</span>‚Ç¨</div>
                    </div>

                    <button type="submit" class="btn-primary">Guardar y Calcular D√≠a</button>
                </form>
            </div>

            <!-- Historial View -->
            <div id="historial-view" class="view">
                <h2>Historial de Registros</h2>
                <div id="historial-content">
                    <p>Cargando historial...</p>
                </div>
            </div>

            <!-- Ajustes View -->
            <div id="ajustes-view" class="view">
                <h2>Ajustes</h2>
                <div class="form-section">
                    <h3>Perfil del Conductor</h3>
                    <div class="form-group">
                        <label for="conductor-nombre">Nombre</label>
                        <input type="text" id="conductor-nombre" placeholder="Tu nombre">
                    </div>
                    <div class="form-group">
                        <label for="conductor-apellido">Apellido</label>
                        <input type="text" id="conductor-apellido" placeholder="Tu apellido">
                    </div>
                    <button class="btn-primary" onclick="guardarPerfil()">Guardar Perfil</button>
                </div>

                <div class="form-section">
                    <h3>D√≠a Libre Semanal</h3>
                    <select id="dia-libre">
                        <option value="">Ninguno</option>
                        <option value="lunes">Lunes</option>
                        <option value="martes">Martes</option>
                        <option value="miercoles">Mi√©rcoles</option>
                        <option value="jueves">Jueves</option>
                        <option value="viernes">Viernes</option>
                        <option value="sabado">S√°bado</option>
                        <option value="domingo">Domingo</option>
                    </select>
                    <div class="button-group">
                        <button class="btn-primary" onclick="guardarDiaLibre()">Guardar</button>
                        <button class="btn-danger" onclick="limpiarDiaLibre()">Limpiar</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="notification" class="notification hidden"></div>

    <script>
        // Simple standalone app with localStorage
        let registros = JSON.parse(localStorage.getItem('conductor-registros') || '[]');
        let conductor = JSON.parse(localStorage.getItem('conductor-perfil') || '{}');

        // Navigation
        function navigateTo(view) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(`${view}-view`).classList.add('active');

            if (view === 'dashboard') loadDashboard();
            if (view === 'registro') setupRegistro();
            if (view === 'historial') loadHistorial();
            if (view === 'ajustes') loadAjustes();
        }

        // Setup navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                navigateTo(e.target.dataset.view);
            });
        });

        // Calculation functions
        function calculateGananciaNeta(data) {
            const gananciaBruta = 
                (data.uber?.app || 0) + 
                (data.freeNow?.app || 0) + 
                (data.freeNow?.tarjeta || 0) + 
                (data.freeNow?.efectivo || 0) + 
                (data.taxiConvencional?.tarjeta || 0) + 
                (data.taxiConvencional?.efectivo || 0);

            const comisionVehiculo = gananciaBruta * 0.52;
            const costoKilometraje = (data.kmRecorridos || 0) * 0.05;
            const comisionFreeNowEfectivo = (data.freeNow?.efectivo || 0) * 0.06;
            const gastosCombustible = data.gastos?.combustible || 0;

            const gananciaNeta = (gananciaBruta - comisionVehiculo - costoKilometraje - comisionFreeNowEfectivo) + gastosCombustible;

            return {
                gananciaBruta,
                comisionVehiculo,
                costoKilometraje,
                comisionFreeNowEfectivo,
                gastosCombustible,
                gananciaNeta
            };
        }

        // Setup registro form
        function setupRegistro() {
            document.getElementById('fecha-registro').value = new Date().toISOString().split('T')[0];
            
            const inputs = ['km-recorridos', 'num-carreras', 'uber-app', 'uber-propinas', 'freenow-app', 'freenow-tarjeta', 'freenow-efectivo', 'freenow-propinas', 'taxi-tarjeta', 'taxi-efectivo', 'combustible'];
            
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', updateCalculationPreview);
                }
            });

            document.getElementById('registro-form').addEventListener('submit', handleRegistroSubmit);
            updateCalculationPreview();
        }

        function updateCalculationPreview() {
            const data = getFormData();
            const calc = calculateGananciaNeta(data);

            document.getElementById('ganancia-bruta').textContent = calc.gananciaBruta.toFixed(2);
            document.getElementById('comision-vehiculo').textContent = calc.comisionVehiculo.toFixed(2);
            document.getElementById('costo-km').textContent = calc.costoKilometraje.toFixed(2);
            document.getElementById('comision-freenow').textContent = calc.comisionFreeNowEfectivo.toFixed(2);
            document.getElementById('gastos-combustible').textContent = calc.gastosCombustible.toFixed(2);
            document.getElementById('ganancia-neta').textContent = calc.gananciaNeta.toFixed(2);
        }

        function getFormData() {
            return {
                fecha: document.getElementById('fecha-registro')?.value,
                kmRecorridos: parseFloat(document.getElementById('km-recorridos')?.value || 0),
                numeroCarreras: parseInt(document.getElementById('num-carreras')?.value || 0),
                uber: {
                    app: parseFloat(document.getElementById('uber-app')?.value || 0),
                    propinas: parseFloat(document.getElementById('uber-propinas')?.value || 0)
                },
                freeNow: {
                    app: parseFloat(document.getElementById('freenow-app')?.value || 0),
                    tarjeta: parseFloat(document.getElementById('freenow-tarjeta')?.value || 0),
                    efectivo: parseFloat(document.getElementById('freenow-efectivo')?.value || 0),
                    propinas: parseFloat(document.getElementById('freenow-propinas')?.value || 0)
                },
                taxiConvencional: {
                    tarjeta: parseFloat(document.getElementById('taxi-tarjeta')?.value || 0),
                    efectivo: parseFloat(document.getElementById('taxi-efectivo')?.value || 0)
                },
                gastos: {
                    combustible: parseFloat(document.getElementById('combustible')?.value || 0)
                }
            };
        }

        function handleRegistroSubmit(e) {
            e.preventDefault();
            const data = getFormData();
            const calc = calculateGananciaNeta(data);
            
            data.id = Date.now();
            data.gananciaBruta = calc.gananciaBruta;
            data.gananciaNeta = calc.gananciaNeta;
            
            registros.unshift(data);
            localStorage.setItem('conductor-registros', JSON.stringify(registros));
            
            showNotification('Registro guardado correctamente', 'success');
            document.getElementById('registro-form').reset();
            document.getElementById('fecha-registro').value = new Date().toISOString().split('T')[0];
            updateCalculationPreview();
            loadDashboard();
        }

        function loadDashboard() {
            const totalKm = registros.reduce((sum, r) => sum + (r.kmRecorridos || 0), 0);
            const totalCarreras = registros.reduce((sum, r) => sum + (r.numeroCarreras || 0), 0);
            const totalGanancias = registros.reduce((sum, r) => sum + (r.gananciaNeta || 0), 0);

            document.getElementById('total-km').textContent = Math.round(totalKm);
            document.getElementById('total-carreras').textContent = Math.round(totalCarreras);
            document.getElementById('total-ganancias').textContent = Math.round(totalGanancias);
        }

        function loadHistorial() {
            const container = document.getElementById('historial-content');
            
            if (registros.length === 0) {
                container.innerHTML = '<p>No hay registros. A√±ade algunos en la secci√≥n Registro.</p>';
                return;
            }

            const totalGanancias = registros.reduce((sum, r) => sum + (r.gananciaNeta || 0), 0);
            
            container.innerHTML = `
                <div style="background: var(--bg-card); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h3>Resumen: ${registros.length} registros - ${totalGanancias.toFixed(2)}‚Ç¨ total</h3>
                </div>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 0.5rem; border: 1px solid var(--border-color);">Fecha</th>
                                <th style="padding: 0.5rem; border: 1px solid var(--border-color);">Km</th>
                                <th style="padding: 0.5rem; border: 1px solid var(--border-color);">Carreras</th>
                                <th style="padding: 0.5rem; border: 1px solid var(--border-color);">Ganancia</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${registros.map(r => `
                                <tr>
                                    <td style="padding: 0.5rem; border: 1px solid var(--border-color);">${new Date(r.fecha).toLocaleDateString('es-ES')}</td>
                                    <td style="padding: 0.5rem; border: 1px solid var(--border-color);">${r.kmRecorridos || 0}</td>
                                    <td style="padding: 0.5rem; border: 1px solid var(--border-color);">${r.numeroCarreras || 0}</td>
                                    <td style="padding: 0.5rem; border: 1px solid var(--border-color); color: var(--accent-primary);">${(r.gananciaNeta || 0).toFixed(2)}‚Ç¨</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function loadAjustes() {
            document.getElementById('conductor-nombre').value = conductor.nombre || '';
            document.getElementById('conductor-apellido').value = conductor.apellido || '';
            document.getElementById('dia-libre').value = conductor.diaLibre || '';
        }

        function guardarPerfil() {
            conductor.nombre = document.getElementById('conductor-nombre').value;
            conductor.apellido = document.getElementById('conductor-apellido').value;
            localStorage.setItem('conductor-perfil', JSON.stringify(conductor));
            showNotification('Perfil guardado', 'success');
        }

        function guardarDiaLibre() {
            conductor.diaLibre = document.getElementById('dia-libre').value;
            localStorage.setItem('conductor-perfil', JSON.stringify(conductor));
            showNotification('D√≠a libre guardado', 'success');
        }

        function limpiarDiaLibre() {
            conductor.diaLibre = '';
            document.getElementById('dia-libre').value = '';
            localStorage.setItem('conductor-perfil', JSON.stringify(conductor));
            showNotification('D√≠a libre eliminado', 'success');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            setTimeout(() => notification.classList.add('hidden'), 3000);
        }

        // PWA Install functionality
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        function showInstallButton() {
            const installBtn = document.createElement('button');
            installBtn.textContent = 'üì± Instalar App';
            installBtn.className = 'btn-primary';
            installBtn.style.position = 'fixed';
            installBtn.style.bottom = '20px';
            installBtn.style.right = '20px';
            installBtn.style.zIndex = '1000';
            installBtn.style.padding = '0.5rem 1rem';
            installBtn.style.fontSize = '0.8rem';
            
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        showNotification('App instalada correctamente', 'success');
                    }
                    deferredPrompt = null;
                    installBtn.remove();
                }
            });
            
            document.body.appendChild(installBtn);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (installBtn.parentNode) {
                    installBtn.remove();
                }
            }, 10000);
        }

        // Android back button support
        window.addEventListener('popstate', (e) => {
            if (document.querySelector('.view.active').id !== 'dashboard-view') {
                navigateTo('dashboard');
            }
        });

        // Prevent zoom on input focus (iOS/Android)
        document.addEventListener('touchstart', function() {}, {passive: true});

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            setupRegistro();
            loadDashboard();
            
            // Show install prompt for Android users
            if (window.matchMedia('(display-mode: browser)').matches) {
                setTimeout(() => {
                    if (!window.matchMedia('(display-mode: standalone)').matches) {
                        showNotification('üí° A√±ade esta app a tu pantalla de inicio para mejor experiencia', 'info');
                    }
                }, 3000);
            }
        });
    </script>
</body>
</html>